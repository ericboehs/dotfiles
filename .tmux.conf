set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/tmux-copycat'
set -g @plugin 'tmux-plugins/tmux-open'
set -g @plugin 'tmux-plugins/tmux-pain-control'
set -g @plugin 'tmux-plugins/tmux-yank'
#set -g @plugin 'catppuccin/tmux'
set -g @plugin 'christoomey/vim-tmux-navigator'
set -g @plugin 'omerxx/tmux-floax'

# Default configurations
set-option -g base-index 1 # Start window index count at 1 instead of 0
setw -g mouse on           # Enable mouse mode: scrolling, pane selecting and window selecting
setw -g mode-keys vi       # use vim keys while in copy mode
set -g allow-passthrough all
setw -g monitor-activity on # Monitor activity in windows
# set -g monitor-silence 0    # Don't monitor silence
# set -g activity-action other # Only trigger on substantial activity
setw -g monitor-bell on     # Monitor bell in windows
set -g bell-action any      # Ring bell for any window
set -g renumber-windows on  # Automatically renumber windows when one is closed
set -g history-limit 500000 # Set very high to prevent claude code scrollback lag

set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"
set -ga terminal-overrides ",*:Ss=\\E[%p1%d q:Se=\\E[2 q"

# make active border bright cyan
set-hook -g pane-focus-out 'select-pane -P "fg=colour240"'
set-hook -g pane-focus-in  'select-pane -P "fg=default"; set-window-option -u @special_activity'
set -g pane-border-style 'fg=#191923'
set -g pane-active-border-style 'fg=#89dceb'

# Plugin configurations
set -g @open-S 'https://google.com/search?q=' # tmux-open Shift-S won't work w/i this
set -g @catppuccin_window_status_enable "yes" # Adds icons to each window (including if it's zoomed)
set -g @catppuccin_window_right_separator " " # Needed as icon was getting cut off

# Yank without leaving copy mode
set -g @yank_action 'copy-pipe'

# Simple status bar
set-option -g status-style "bg=default,fg=white"               # Transparent
set-option -g status 2                                        # Add top margin
set-option -g status-format[0] ""                             # Empty the top line
# Status format: zoom-icon + window-numbers + activity-indicators (⊙ = claude,• = bell) + spacing
set -g status-format[1] "\
#{W:#{?window_active,#{?window_zoomed_flag,󰊓, },}} \
#{W:\
#{?window_active,#[fg=#89dceb],}\
#I\
#{?#{@special_activity},⊙,#{?#{window_bell_flag},•, }} \
#{?window_active,#[fg=white],}\
}\
#[align=right]#[fg=colour240]%H:%M CT"

# Keybindings
bind-key Escape copy-mode # Prefix + Escape to enter copy mode
bind-key -T copy-mode-vi v send-keys -X begin-selection # Make v work like you'd expect in copy mode
bind-key -T copy-mode-vi Escape send-keys -X cancel

# Override tmux-copycat's Ctrl-F to page forward instead of file search
bind-key -T copy-mode-vi C-f send-keys -X page-down

# Make session chooser start from 1 instead of 0. See: https://unix.stackexchange.com/a/755474.
bind-key s choose-tree -ZsK '#{?#{e|<:#{line},9},#{e|+:1,#{line}},#{?#{e|<:#{line},35},M-#{a:#{e|+:97,#{e|-:#{line},9}}},}}'

# Switch windows via Ctrl+number. For iTerm2: https://unix.stackexchange.com/a/314150
bind -n C-1 select-window -t 1
bind -n C-2 select-window -t 2
bind -n C-3 select-window -t 3
bind -n C-4 select-window -t 4
bind -n C-5 select-window -t 5
bind -n C-6 select-window -t 6
bind -n C-7 select-window -t 7
bind -n C-8 select-window -t 8
bind -n C-9 select-window -t 9

# Switch windows via Ctrl+number for Blink/iOS (user-keys with custom escape sequences)
# Blink Custom Presses: set Ctrl-N to custom string \x1b[4N;9~ (e.g. Ctrl-1 = \x1b[41;9~)
set -s user-keys[0] "\e[41;9~"
set -s user-keys[1] "\e[42;9~"
set -s user-keys[2] "\e[43;9~"
set -s user-keys[3] "\e[44;9~"
set -s user-keys[4] "\e[45;9~"
set -s user-keys[5] "\e[46;9~"
set -s user-keys[6] "\e[47;9~"
set -s user-keys[7] "\e[48;9~"
set -s user-keys[8] "\e[49;9~"
bind -n User0 select-window -t 1
bind -n User1 select-window -t 2
bind -n User2 select-window -t 3
bind -n User3 select-window -t 4
bind -n User4 select-window -t 5
bind -n User5 select-window -t 6
bind -n User6 select-window -t 7
bind -n User7 select-window -t 8
bind -n User8 select-window -t 9

# Switch sessions via Alt+number (sorted by creation time to match Prefix+s)
bind -n M-1 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 1p)'
bind -n M-2 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 2p)'
bind -n M-3 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 3p)'
bind -n M-4 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 4p)'
bind -n M-5 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 5p)'
bind -n M-6 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 6p)'
bind -n M-7 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 7p)'
bind -n M-8 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 8p)'
bind -n M-9 run-shell 'tmux switch-client -t $(tmux list-sessions -F "##{session_created}:##S" | sort -n | cut -d: -f2 | sed -n 9p)'

# Neovim :terminal bindings for fading inactive panes
# set-option -g default-command 'nvim +terminal +startinsert +"autocmd TermClose * ++once quit"'

# Send literal Ctrl+h|j|k|l
bind C-h send-keys 'C-h'
bind C-j send-keys 'C-j'
bind C-k send-keys 'C-k'
bind C-l send-keys 'C-l'

# Emoji selector
bind e run-shell 'tmux new-window "ranger ~/Code/slack-emojis/; sleep 0.2; buffer=\$(tmux show-buffer); if [[ \$buffer != *$'\''\n'\''* ]]; then tmux send-keys -t #{pane_id} \"\$buffer\"; fi"'
bind g run-shell 'tmux new-window "ranger /Users/ericboehs/.local/share/weechat/xfer"'
bind C new-window opencode
bind m set mouse \; display "Mouse #{?mouse,on,off}"

# Allow custom configuration
if '[ -f ~/.tmux.conf.local ]' 'source ~/.tmux.conf.local'

# Initialize TMUX plugin manager (keep this line at the very bottom of tmux.conf)
run '~/.tmux/plugins/tpm/tpm'
